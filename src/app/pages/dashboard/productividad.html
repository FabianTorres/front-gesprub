<div class="grid">
    <div class="col-12">
        <div class="card">
            <div class="flex justify-between items-center flex-wrap gap-2">
                <h2 class="text-2xl font-semibold m-0">Productividad y Carga de Trabajo</h2>
                <p-selectButton [options]="opcionesPeriodo" [(ngModel)]="periodoSeleccionado" optionLabel="label" optionValue="value"></p-selectButton>
            </div>
        </div>
    </div>

    <div *ngIf="cargando()" class="col-12 text-center p-4">
        <i class="pi pi-spin pi-spinner text-4xl text-primary"></i>
        <p class="mt-2 text-lg text-surface-500">Cargando datos del reporte...</p>
    </div>

    <ng-container *ngIf="!cargando() && productividadData() as data">
        <div class="col-12 lg:col-6">
            <div class="card h-full">
                <h3 class="font-semibold mb-3">Carga de Trabajo Actual por Usuario</h3>
                <div class="chart-container" style="position: relative; height: 380px">
                    <p-chart type="bar" [data]="cargaChartData" [options]="cargaChartOptions"></p-chart>
                </div>
            </div>
        </div>

        <div class="col-12 lg:col-6">
            <div class="card h-full">
                <h3 class="font-semibold mb-3">Productividad Reciente</h3>
                <div class="chart-container" style="position: relative; height: 380px">
                    <p-chart type="bar" [data]="productividadChartData" [options]="productividadChartOptions"></p-chart>
                </div>
            </div>
        </div>

        <div class="col-12">
            <div class="card">
                <h3 class="font-semibold mb-3">Resumen por Usuario</h3>
                <p-table [value]="data.cargaPorUsuario" responsiveLayout="scroll">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>Usuario</th>
                            <th>Total Asignado</th>
                            <th>Pendientes (Sin Ejecutar)</th>
                            <th>Completados (OK)</th>
                            <th>Fallidos (NK)</th>
                            <th>Ãšltima Actividad</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-usuario>
                        <tr>
                            <td>{{ usuario.nombreUsuario }}</td>
                            <td>{{ usuario.casosAsignados.total }}</td>
                            <td>{{ usuario.casosAsignados.sinEjecutar }}</td>
                            <td>{{ usuario.casosAsignados.ok }}</td>
                            <td>{{ usuario.casosAsignados.nk }}</td>
                            <td>{{ usuario.ultimaActividad | date:'short' }}</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </ng-container>
</div>